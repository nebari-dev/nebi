# K8s test overrides for testing Postgres + Valkey in local k3d environment
# This file is used to test the production stack locally

## Image configuration for local development
image:
  pullPolicy: Never  # Use locally built images, don't pull from registry
  tag: "latest"

## Service configuration for local access
service:
  type: NodePort
  nodePort: 30080  # Fixed port for consistent local access

## Resource limits - relaxed for local dev but with postgres/valkey
resources:
  requests:
    memory: "128Mi"
    cpu: "50m"
  limits:
    memory: "1Gi"
    cpu: "500m"

## Persistence - use k3s local-path for dev
persistence:
  enabled: true
  data:
    storageClass: "local-path"
    accessMode: ReadWriteOnce
    size: 2Gi

  environments:
    storageClass: "local-path"
    accessMode: ReadWriteOnce  # local-path doesn't support ReadWriteMany
    size: 10Gi

## Application configuration for development
config:
  ginMode: debug
  logLevel: debug
  logFormat: text

## Database configuration - PostgreSQL for testing
database:
  driver: postgres
  # DSN will be auto-constructed from postgres values
  dsn: ""
  maxIdleConns: 10
  maxOpenConns: 50
  connMaxLifetime: 60

## Queue configuration - Valkey for testing
queue:
  type: valkey
  # Address will be auto-constructed from valkey values
  valkeyAddr: ""

## PostgreSQL - enabled for testing
postgres:
  enabled: true
  image:
    repository: postgres
    tag: "18"
    pullPolicy: IfNotPresent
  database: darb
  user: darb
  password: "testpassword123"
  storage: 5Gi
  storageClassName: "local-path"
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

## Valkey - enabled for testing
valkey:
  enabled: true
  image:
    repository: valkey/valkey
    tag: "9.0.0"
    pullPolicy: IfNotPresent
  persistence:
    enabled: false  # No persistence needed for testing
    size: 2Gi
    storageClassName: "local-path"
  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "200m"

## Worker - single pod in development (API + Worker together)
worker:
  separateDeployment: false

## Default admin user (created on first startup if no users exist)
admin:
  username: "admin"
  password: "admin123"
  email: "admin@darb.local"

## Health probes - faster for development
livenessProbe:
  initialDelaySeconds: 10
  periodSeconds: 15

readinessProbe:
  initialDelaySeconds: 5
  periodSeconds: 5
