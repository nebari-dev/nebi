# Default values for Darb
# This is a YAML-formatted file with production-ready defaults
# Override these values using values-dev.yaml for local development

## Global settings
nameOverride: ""
fullnameOverride: ""

## Deployment configuration
deployment:
  # API deployment configuration
  api:
    replicas: 2
    resources:
      requests:
        memory: 256Mi
        cpu: 100m
      limits:
        memory: 512Mi  # Lower memory - no job execution
        cpu: 500m

  # Worker deployment configuration
  worker:
    replicas: 2  # Base replica count (can be scaled manually or via KEDA)
    resources:
      requests:
        memory: 1Gi
        cpu: 500m
      limits:
        memory: 2Gi  # Higher memory - runs pixi jobs
        cpu: 2000m

## Image configuration
image:
  repository: darb
  pullPolicy: IfNotPresent
  tag: "latest"

imagePullSecrets: []

## Service account
serviceAccount:
  create: true
  annotations: {}
  name: ""

## Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65532
  runAsGroup: 65532
  fsGroup: 65532
  fsGroupChangePolicy: "OnRootMismatch"

## Container security context
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false

## Service configuration
service:
  type: ClusterIP
  port: 80
  targetPort: 8080
  annotations: {}

## Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: darb.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

## Resource limits
resources:
  requests:
    memory: "128Mi"
    cpu: "100m"
  limits:
    memory: "512Mi"
    cpu: "500m"

## Replica count
replicaCount: 1

## Persistence configuration
persistence:
  enabled: true

  # Database storage
  data:
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 5Gi
    annotations: {}

  # Pixi environments storage
  environments:
    storageClass: ""
    accessMode: ReadWriteMany
    size: 20Gi
    annotations: {}

## Application configuration
config:
  ginMode: release
  databasePath: /app/data/darb.db
  logLevel: info
  logFormat: json

## Health probes
livenessProbe:
  httpGet:
    path: /api/v1/health
    port: 8080
  initialDelaySeconds: 10
  periodSeconds: 30
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /api/v1/health
    port: 8080
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 3
  failureThreshold: 3

## Node selector
nodeSelector: {}

## Tolerations
tolerations: []

## Affinity
affinity: {}

## Pod annotations
podAnnotations: {}

## Pod labels
podLabels: {}

## Database configuration
database:
  # Driver: "sqlite" or "postgres"
  driver: postgres
  # DSN will be constructed automatically if using embedded postgres
  # For external postgres, set dsn explicitly
  dsn: ""
  # Connection pool settings (Postgres only)
  maxIdleConns: 10
  maxOpenConns: 100
  connMaxLifetime: 60  # minutes

## Queue configuration
queue:
  # Type: "memory" or "valkey"
  type: valkey
  # Valkey address will be constructed automatically if using embedded valkey
  # For external valkey, set address explicitly
  valkeyAddr: ""

## PostgreSQL (optional embedded database)
postgres:
  enabled: true
  image:
    repository: postgres
    tag: "18"  # Latest PostgreSQL 18
    pullPolicy: IfNotPresent
  database: darb
  user: darb
  password: "changeme-in-production"
  storage: 10Gi
  storageClassName: ""
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

## Valkey (optional embedded cache/queue)
valkey:
  enabled: true
  image:
    repository: valkey/valkey
    tag: "9.0.0"  # Latest Valkey 9.0
    pullPolicy: IfNotPresent
  persistence:
    enabled: false
    size: 5Gi
    storageClassName: ""
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
